* Author Guidelines

* Under the Hood

#+BEGIN_SRC makefile :tangle coq.mk
COQ_POSTS := $(shell find site/ -name "*.v")
COQ_HTML := $(COQ_POSTS:.v=.html)
COQ_ARTIFACTS := $(COQ_POSTS:.v=.vo) \
  $(COQ_POSTS:.v=.vok) \
  $(COQ_POSTS:.v=.vos) \
  $(COQ_POSTS:.v=.glob) \
  $(join $(dir ${COQ_POSTS}),$(addprefix ".",$(notdir $(COQ_POSTS:.v=.aux))))

coq-build : ${COQ_HTML}

theme-build : site/style/coq.sass
soupault-build : coq-build

ARTIFACTS += ${COQ_ARTIFACTS} .lia.cache
ARTIFACTS += ${COQ_HTML}

COQLIB := "https://coq.inria.fr/distrib/current/stdlib/"
COQCARG := -async-proofs-cache force \
           -w -custom-entry-overriden
COQDOCARG := --no-index --charset utf8 --short \
             --body-only --coqlib "${COQLIB}" \
             --external "https://coq-community.org/coq-ext-lib/v0.11.2/" ExtLib \
             --external "https://compcert.org/doc/html" compcert \
             --external "https://lysxia.github.io/coq-simple-io" SimpleIO

%.html : %.v coq.mk
	@cleopatra echo Exporting "$*.v"
	@coqc ${COQCARG} $<
	@coqdoc ${COQDOCARG} -d $(shell dirname $<) $<
	@rm -f $(shell dirname $<)/coqdoc.css
#+END_SRC

#+BEGIN_SRC sass :tangle site/style/coq.sass
div.code
    padding-left : 1.5rem
    padding-left : 1.5rem
    white-space: nowrap
    line-height : 140%

div.code,
span.inlinecode
    font-family : 'Fira Code', monospace
    color : $monospace-color
    font-size : 80%
    overflow-x : auto

div.doc
    max-width : $content-width
    line-height : 140%

    /* dirty patch to get the code in full page width */
    pre
        width : calc(100vw - 2*var(--side-margin))

.paragraph
    margin-bottom : .8em
#+END_SRC

#+BEGIN_SRC sass :tangle site/style/coq.sass
.code
    a[href]
        color : inherit
        text-decoration : none
        background : #f7f7f7
        padding : .1rem .15rem .1rem .15rem
        border-radius : 15%

        .url-mark
            display: none
#+END_SRC

# Local Variables:
# org-src-preserve-indentation: t
# End:
